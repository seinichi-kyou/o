<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>OHAYO Premium Shuffle Lottery</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    text-align: center;
    background: #111;
    color: #fff;
    padding: 20px;
  }

  h2 {
    color: #f7cf4a;
    margin-bottom: 14px;
    font-weight: 600;
    letter-spacing: 1px;
    font-size: 22px;
  }

  /* Refresh button */
  #refreshBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    padding: 8px 14px;
    background: #222;
    color: #f7cf4a;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #444;
    cursor: pointer;
    z-index: 999;
  }

  .inputBox {
    margin: 10px 0;
    font-size: 16px;
  }
  input {
    width: 70px;
    padding: 6px;
    font-size: 18px;
    text-align: center;
    border-radius: 6px;
    border: 1px solid #444;
    background: #222;
    color: #f7cf4a;
  }

  #startPanel button {
    padding: 12px 25px;
    font-size: 20px;
    margin-top: 20px;
    border-radius: 8px;
    border: none;
    background: linear-gradient(135deg, #f7cf4a, #e6b82e);
    color: #000;
    font-weight: bold;
    cursor: pointer;
  }

  /* Game area */
  .container {
    display: none;
    position: relative;
    width: 360px;
    height: 450px;
    margin: 20px auto;
  }

  .card {
    width: 70px;
    height: 100px;
    position: absolute;
    cursor: pointer;
    perspective: 1000px;
  }

  .inner {
    width: 100%;
    height: 100%;
    transition: transform 0.7s;
    transform-style: preserve-3d;
  }

  .inner.open {
    transform: rotateY(180deg);
  }

  /* Card faces */
  .face {
    backface-visibility: hidden;
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 6px 14px rgba(0,0,0,0.6);
    font-size: 16px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* FRONT: Black & Gold */
  .front {
    background: #000;
    border: 2px solid #f7cf4a;
    color: #f7cf4a;
    font-weight: bold;
  }

  /* BACK: White */
  .back {
    background: #fff;
    color: #000;
    padding: 4px;
    border: 2px solid #f7cf4a;
    transform: rotateY(180deg);
  }

  #status {
    display: none;
    margin-top: 10px;
    font-size: 20px;
    color: #f7cf4a;
  }

  /* Dialog */
  #dialog {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #222;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.6);
    z-index: 999;
    color: #f7cf4a;
    width: 260px;
  }
  #dialog button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #f7cf4a, #e6b82e);
    color: #000;
    font-weight: bold;
  }
</style>
</head>

<body>

<!-- Refresh Button -->
<button id="refreshBtn" onclick="location.reload()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>

<!-- Start Panel -->
<div id="startPanel">
  <h2>ğŸ¯ OHAYO Premium ãã˜è¨­å®š</h2>

  <div class="inputBox">è³å“1ï¼ˆ1ç­‰ï¼‰ï¼š <input id="s1" type="number" min="0" value="1"> å€‹</div>
  <div class="inputBox">è³å“2ï¼ˆ2ç­‰ï¼‰ï¼š <input id="s2" type="number" min="0" value="2"> å€‹</div>
  <div class="inputBox">è³å“3ï¼ˆ3ç­‰ï¼‰ï¼š <input id="s3" type="number" min="0" value="3"> å€‹</div>
  <div class="inputBox">ã‚«ãƒ¼ãƒ‰æšæ•°ï¼š <input id="cardNum" type="number" min="5" max="40" value="20"></div>
  <div class="inputBox">1äººã‚ãŸã‚Šå›æ•°ï¼š <input id="turns" type="number" min="1" max="10" value="3"></div>

  <button onclick="setupGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
</div>

<div id="status">æ®‹ã‚Šå›æ•°ï¼š<span id="remain"></span> å›</div>
<div class="container" id="cards"></div>

<!-- Dialog -->
<div id="dialog">
  <h3 id="dialogTitle">ğŸ‰ å½“ãŸã‚Šï¼ ç¶šã‘ã¾ã™ã‹ï¼Ÿ</h3>
  <button onclick="continueGame()">ç¶šã‘ã‚‹</button>
  <button onclick="stopGame()">ã‚„ã‚ã‚‹</button>
</div>


<script>

let prizes = [];
let remaining = 3;
let TOTAL = 20;
let gameLocked = false;
let currentPrize = "";

/* --- Setup --- */
function setupGame() {
  const s1v = Number(document.getElementById("s1").value);
  const s2v = Number(document.getElementById("s2").value);
  const s3v = Number(document.getElementById("s3").value);
  TOTAL = Number(document.getElementById("cardNum").value);
  remaining = Number(document.getElementById("turns").value);

  prizes = [];
  for (let i=0; i<s1v; i++) prizes.push("ğŸ‰ 1ç­‰");
  for (let i=0; i<s2v; i++) prizes.push("ğŸ§ 2ç­‰");
  for (let i=0; i<s3v; i++) prizes.push("ğŸ· 3ç­‰");

  while (prizes.length < TOTAL) prizes.push("âŒ ãƒã‚ºãƒ¬");

  document.getElementById("startPanel").style.display = "none";
  document.getElementById("remain").textContent = remaining;
  document.getElementById("status").style.display = "block";

  createCards();
  scatter();
  shuffle();
  setTimeout(() => align(), 1500);
}

/* --- Create cards --- */
function createCards() {
  const c = document.getElementById("cards");
  c.innerHTML = "";
  c.style.display = "block";

  for (let i=0; i<TOTAL; i++) {
    const card = document.createElement("div");
    card.className="card";

    const inner=document.createElement("div");
    inner.className="inner";

    const front=document.createElement("div");
    front.className="face front";
    front.textContent="OHAYO";

    const back=document.createElement("div");
    back.className="face back";
    back.textContent="";

    inner.appendChild(front);
    inner.appendChild(back);
    card.appendChild(inner);
    c.appendChild(card);
  }
}

/* Random scatter */
function scatter() {
  document.querySelectorAll(".card").forEach(card=>{
    card.style.left = Math.random()*260+"px";
    card.style.top  = Math.random()*350+"px";
  });
}

/* Shuffle animation */
function shuffle() {
  let count=0;
  const timer = setInterval(()=>{
    document.querySelectorAll(".card").forEach(card=>{
      card.style.left = Math.random()*260+"px";
      card.style.top  = Math.random()*350+"px";
    });
    count++;
    if(count>10) clearInterval(timer);
  },100);
}

/* Align neatly */
function align() {
  const cards=document.querySelectorAll(".card");
  let idx=0;

  cards.forEach(card=>{
    let row=Math.floor(idx/5);
    let col=idx%5;
    card.style.transition="all 0.6s";
    card.style.left=col*75+"px";
    card.style.top =row*110+"px";
    idx++;
  });

  assignPrizes();
}

/* Assign prizes */
function assignPrizes() {
  let list=[...prizes];
  const cards=document.querySelectorAll(".card");

  cards.forEach(card=>{
    const prize=list.splice(Math.floor(Math.random()*list.length),1)[0];
    const back=card.querySelector(".back");
    back.textContent=prize;

    card.onclick=()=>{
      if(gameLocked) return;

      const inner=card.querySelector(".inner");
      if(inner.classList.contains("open")) return;
      if(remaining<=0) return;

      inner.classList.add("open");
      remaining--;
      document.getElementById("remain").textContent=remaining;

      if(prize.includes("ç­‰")){
        currentPrize = prize;
        gameLocked = true;

        document.getElementById("dialogTitle").innerHTML =
          `ğŸ‰ ${currentPrize} å½“é¸ï¼ ç¶šã‘ã¾ã™ã‹ï¼Ÿ`;

        document.getElementById("dialog").style.display="block";

        const i=prizes.indexOf(prize);
        if(i!==-1) prizes.splice(i,1);
      }
    };
  });
}

/* Dialog actions */
function continueGame(){
  gameLocked=false;
  document.getElementById("dialog").style.display="none";
}
function stopGame(){
  alert("ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼");
  location.reload();
}

</script>

</body>
</html>
