<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>OHAYO Premium Lottery</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    text-align: center;
    background: #111;
    color: #fff;
    padding: 5px;
  }

  h2 {
    color: #f7cf4a;
    margin-bottom: 6px;
    font-weight: 600;
    letter-spacing: 1px;
    font-size: 20px;
  }

  /* è¨­å®šãƒ‘ãƒãƒ« */
  #startPanel {
    background: #000;
    border: 1px solid #444;
    padding: 10px;
    border-radius: 10px;
    width: 330px;
    margin: 0 auto 6px auto;
  }

  #startPanel .inputBox {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 5px 0;
    font-size: 15px;
  }

  input {
    width: 70px;
    padding: 6px;
    font-size: 16px;
    text-align: center;
    border-radius: 6px;
    border: 1px solid #444;
    background: #222;
    color: #f7cf4a;
  }

  #startPanel button {
    padding: 8px 18px;
    font-size: 18px;
    margin-top: 10px;
    border-radius: 8px;
    border: none;
    background: linear-gradient(135deg, #f7cf4a, #e6b82e);
    color: #000;
    font-weight: bold;
    cursor: pointer;
  }

  /* æ®‹ã‚Šå›æ•°è¡¨ç¤º */
  #status {
    display: none;
    margin-top: 8px;
    margin-bottom: 6px;
    font-size: 20px;
    color: #f7cf4a;
  }

  /* ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠï¼ˆé«˜ã•å¯å¤‰ï¼‰ */
  .container {
    display: none;
    position: relative;
    width: 360px;
    margin: 0 auto;
  }

  .card {
    width: 70px;
    height: 100px;
    position: absolute;
    cursor: pointer;
    perspective: 1000px;
  }

  .inner {
    width: 100%;
    height: 100%;
    transition: transform 0.7s;
    transform-style: preserve-3d;
  }

  .inner.open {
    transform: rotateY(180deg);
  }

  .face {
    backface-visibility: hidden;
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 6px 14px rgba(0,0,0,0.6);
    font-size: 16px;
    white-space: nowrap;
    overflow: hidden;
  }

  .front {
    background: #000;
    border: 2px solid #f7cf4a;
    color: #f7cf4a;
    font-weight: bold;
  }

  .back {
    background: #fff;
    color: #000;
    border: 2px solid #f7cf4a;
    transform: rotateY(180deg);
  }

  /* å½“ãŸã‚Šãƒ”ã‚«ãƒƒï¼ */
  .flash {
    animation: flashAnim 0.7s ease-out;
  }
  @keyframes flashAnim {
    0%   { box-shadow: 0 0 25px 12px gold; }
    100% { box-shadow: 0 0 0 0 gold; }
  }

  /* å½“é¸ãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
  #dialog {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #222;
    padding: 22px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.6);
    z-index: 999;
    color: #f7cf4a;
    width: 260px;
  }

  #dialog button {
    padding: 10px 20px;
    margin: 10px 6px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #f7cf4a, #e6b82e);
    color: #000;
    font-weight: bold;
  }

  /* æ®‹å¿µã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
  #sorryEffect {
    display: none;
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 48px;
    color: #ff557f;
    font-weight: bold;
    text-shadow: 0 0 20px #ff99aa;
    z-index: 2000;
    opacity: 0;
    transition: opacity 0.7s ease;
    animation: shake 0.4s ease-in-out infinite alternate;
  }
  @keyframes shake {
    0%   { transform: translateX(-50%) rotate(-6deg); }
    100% { transform: translateX(-50%) rotate(6deg); }
  }

  /* ã‚¹ãƒãƒ›æœ€é©åŒ– */
  @media (max-width: 480px) {
    .container {
      transform: scale(0.92);
      transform-origin: top center;
    }
    #startPanel {
      width: 92%;
    }
  }

  /* å…¨ãƒªã‚»ãƒƒãƒˆ */
  #reloadBtn {
    position: fixed;
    top: 15px;
    right: 15px;
    padding: 8px 14px;
    background: #222;
    color: #f7cf4a;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #444;
    cursor: pointer;
    z-index: 999;
  }
</style>
</head>

<body>

<button id="reloadBtn" onclick="location.reload()">ğŸ”„ å…¨ãƒªã‚»ãƒƒãƒˆ</button>

<div id="sorryEffect">ğŸ’¥ğŸ˜­ æ®‹å¿µï¼ï¼ ğŸ˜­ğŸ’¥</div>

<!-- è¨­å®šãƒ‘ãƒãƒ« -->
<div id="startPanel">
  <h2>ğŸ¯ OHAYO Premium ãã˜è¨­å®š</h2>

  <div class="inputBox">è³å“1ï¼ˆ1ç­‰ï¼‰ï¼š <input id="s1" type="number" min="0" value="1"> å€‹</div>
  <div class="inputBox">è³å“2ï¼ˆ2ç­‰ï¼‰ï¼š <input id="s2" type="number" min="0" value="2"> å€‹</div>
  <div class="inputBox">è³å“3ï¼ˆ3ç­‰ï¼‰ï¼š <input id="s3" type="number" min="0" value="3"> å€‹</div>
  <div class="inputBox">ã‚«ãƒ¼ãƒ‰æšæ•°ï¼š <input id="cardNum" type="number" min="5" max="40" value="20"></div>
  <div class="inputBox">1äººã‚ãŸã‚Šå›æ•°ï¼š <input id="turns" type="number" min="1" max="10" value="3"></div>

  <button onclick="setupGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
</div>

<div id="status">æ®‹ã‚Šå›æ•°ï¼š<span id="remain"></span> å›</div>

<!-- ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
<div class="container" id="cards"></div>

<!-- å½“é¸ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
<div id="dialog">
  <h3 id="dialogTitle">ğŸ‰ å½“é¸ï¼</h3>
  <button id="continueBtn" onclick="continueGame()">ç¶šã‘ã‚‹</button>
  <button id="receiveBtn" onclick="receivePrize()">å—ã‘å–ã‚‹</button>
</div>

<script>
let prizes = [];
let remaining = 3;
let TOTAL = 20;
let gameLocked = false;
let currentPrize = "";
let canDrawMoreOnWin = false;

/* æ®‹å¿µæ¼”å‡º */
function showSorryEffect(){
  const el = document.getElementById("sorryEffect");
  el.style.display = "block";
  setTimeout(()=> el.style.opacity = 1, 20);
  setTimeout(()=>{
    el.style.opacity = 0;
    setTimeout(()=> el.style.display = "none", 700);
  }, 2000);
}

/* ã‚²ãƒ¼ãƒ ã ã‘åˆæœŸåŒ–ï¼ˆæ•°å€¤ä¿æŒï¼‰ */
function resetGameOnly() {
  const c = document.getElementById("cards");
  c.innerHTML = "";
  c.style.display = "none";
  document.getElementById("status").style.display = "none";
  gameLocked = false;
  currentPrize = "";
}

/* ã‚¹ã‚¿ãƒ¼ãƒˆ */
function setupGame() {
  const s1v = Number(document.getElementById("s1").value);
  const s2v = Number(document.getElementById("s2").value);
  const s3v = Number(document.getElementById("s3").value);
  TOTAL     = Number(document.getElementById("cardNum").value);
  remaining = Number(document.getElementById("turns").value);

  // æ™¯å“ç”Ÿæˆ
  prizes = [];
  for (let i=0; i<s1v; i++) prizes.push("ğŸ‰ 1ç­‰");
  for (let i=0; i<s2v; i++) prizes.push("ğŸ§ 2ç­‰");
  for (let i=0; i<s3v; i++) prizes.push("ğŸ· 3ç­‰");
  while (prizes.length < TOTAL) prizes.push("âŒ ãƒã‚ºãƒ¬");

  // è¡¨ç¤º
  document.getElementById("remain").textContent = remaining;
  document.getElementById("status").style.display = "block";

  createCards();
  scatter();
  shuffle();
  setTimeout(() => align(), 1500);
}

/* ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ */
function createCards() {
  const c = document.getElementById("cards");
  c.innerHTML = "";
  c.style.display = "block";
}

/* æ•£å¸ƒæ¼”å‡º */
function scatter() {
  for(let i=0;i<TOTAL;i++){
    const card = buildCard();
    const container = document.getElementById("cards");
    container.appendChild(card);

    card.style.left = Math.random()*260+"px";
    card.style.top  = Math.random()*300+"px";
  }
}

/* ã‚«ãƒ¼ãƒ‰ä½œæˆ */
function buildCard(){
  const card = document.createElement("div");
  card.className="card";

  const inner=document.createElement("div");
  inner.className="inner";

  const front=document.createElement("div");
  front.className="face front";
  front.textContent="OHAYO";

  const back=document.createElement("div");
  back.className="face back";

  inner.appendChild(front);
  inner.appendChild(back);
  card.appendChild(inner);

  return card;
}

/* ã‚·ãƒ£ãƒƒãƒ•ãƒ« */
function shuffle() {
  let count=0;
  const timer = setInterval(()=>{
    document.querySelectorAll(".card").forEach(card=>{
      card.style.left = Math.random()*260+"px";
      card.style.top  = Math.random()*300+"px";
    });
    count++;
    if(count>10) clearInterval(timer);
  },100);
}

/* æ•´åˆ—ï¼ˆé«˜ã•è‡ªå‹•èª¿æ•´ï¼‰ */
function align() {
  const cards=document.querySelectorAll(".card");

  let rows = Math.ceil(TOTAL / 5);
  let container = document.getElementById("cards");
  container.style.height = (rows * 110 + 20) + "px";

  let idx=0;
  cards.forEach(card=>{
    let row=Math.floor(idx/5);
    let col=idx%5;

    card.style.transition="all 0.6s";
    card.style.left=col*75+"px";
    card.style.top =row*110+"px";
    idx++;
  });

  assignPrizes();
}

/* æ™¯å“è‡ªå‹•æ¸›ç®— */
function reducePrizeCount(prize){
  if(prize.includes("1ç­‰")){
    const el = document.getElementById("s1");
    el.value = Math.max(0, Number(el.value) - 1);
  } else if(prize.includes("2ç­‰")){
    const el = document.getElementById("s2");
    el.value = Math.max(0, Number(el.value) - 1);
  } else if(prize.includes("3ç­‰")){
    const el = document.getElementById("s3");
    el.value = Math.max(0, Number(el.value) - 1);
  }
}

/* è³å“å‰²å½“ */
function assignPrizes() {
  let list=[...prizes];
  const cards=document.querySelectorAll(".card");

  cards.forEach(card=>{
    const prize=list.splice(Math.floor(Math.random()*list.length),1)[0];
    const back=card.querySelector(".back");
    back.textContent=prize;

    card.onclick=()=>{
      if(gameLocked) return;

      const inner=card.querySelector(".inner");
      if(inner.classList.contains("open")) return;
      if(remaining<=0) return;

      inner.classList.add("open");
      remaining--;
      document.getElementById("remain").textContent=remaining;

      // æœ€å¾ŒãŒãƒã‚ºãƒ¬ â†’ æ®‹å¿µ
      if(remaining<=0 && prize === "âŒ ãƒã‚ºãƒ¬"){
        showSorryEffect();
      }

      // å½“é¸
      if(prize.includes("ç­‰")){
        gameLocked=true;
        currentPrize=prize;

        back.classList.add("flash");
        setTimeout(()=> back.classList.remove("flash"), 800);

        const dlg=document.getElementById("dialog");
        const title=document.getElementById("dialogTitle");
        const continueBtn=document.getElementById("continueBtn");

        if(remaining>0){
          canDrawMoreOnWin = true;
          title.textContent=`ğŸ‰ ${prize} å½“é¸ï¼ ç¶šã‘ã¾ã™ã‹ï¼Ÿ`;
          continueBtn.textContent="ç¶šã‘ã‚‹";
        } else {
          canDrawMoreOnWin = false;
          title.textContent=`ğŸ‰ ${prize} å½“é¸ï¼ å—ã‘å–ã‚Šã¾ã™ã‹ï¼Ÿ`;
          continueBtn.textContent="ç¶šã‘ã‚‹";
        }

        dlg.style.display="block";
      }
    };
  });
}

/* ç¶šã‘ã‚‹ */
function continueGame(){
  document.getElementById("dialog").style.display="none";

  if(canDrawMoreOnWin){
    gameLocked=false; // æ¬¡ã‚’å¼•ã‘ã‚‹
  } else {
    resetGameOnly();  // æ¬¡ã®äººã¸
  }
}

/* å—ã‘å–ã‚‹ */
function receivePrize(){
  if(currentPrize){
    reducePrizeCount(currentPrize);
  }
  document.getElementById("dialog").style.display="none";
  resetGameOnly();
}

</script>
</body>
</html>
